//
//  ChunkWorld.swift
//  TowerUp
//
//  Created by Pablo Henrique Bertaco on 8/11/15.
//  Copyright (c) 2015 WTFGames. All rights reserved.
//

import UIKit
import SpriteKit

class ChunkWorld: SKSpriteNode {
    
    static var sizeInTiles:CGFloat = 21
    static var sizeInPoints:CGFloat = Tile.sizeInPoints * sizeInTiles
    
    var type = "dirt" //TODO
    
    
    
    init(regionX:Int, regionY:Int) {
        super.init(texture: nil, color: nil, size: CGSize(width: ChunkWorld.sizeInPoints, height: ChunkWorld.sizeInPoints))
        
        self.anchorPoint = CGPointZero
        self.load(regionX, regionY: regionY)
    }
    
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
    override func removeAllChildren() {
        dispatch_async(dispatch_get_main_queue()) {
            super.removeAllChildren()
        }
    }
    
    func loadData(data: NSArray){
        var i = 0
        var tiles:NSMutableArray = NSMutableArray()
        for (var y = 0; y < Int(ChunkWorld.sizeInTiles); y++) {
            for (var x = 0; x <  Int(ChunkWorld.sizeInTiles); x++) {
                if(data[i].integerValue != 0) {
                    var tile = Ground(type: self.type, id: data[i].integerValue, x: x, y: y)
                    
                    //MapManagerWorld.loading é setado para true durante o update do MapManagerWorld. No carregamento inicial seu valor é false
                    if(MapManagerWorld.loading) {
                        tiles.addObject(tile)
                    } else {
                        self.addChild(tile)
                    }
                }
                i++
            }
        }
        
        if(MapManagerWorld.loading){
            dispatch_async(dispatch_get_main_queue()) {
                for tile in tiles {
                    self.addChild(tile as! SKNode)
                }
            }
        }
    }
    
    func load(regionX:Int, regionY:Int) {
        self.position = CGPoint(x: self.size.width * (CGFloat)(regionX), y: self.size.height * (CGFloat)(regionY))
        
        switch ("\(regionX) \(regionY)") {
            
        case "0 0":
            self.loadData([
                
                17,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,17,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17
                
                
                ])
            break
            
        case "1 0":
            self.loadData([
                
                17,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,17,
                0,17,0,0,0,0,0,0,0,17,17,0,0,0,0,0,0,0,0,0,17,
                0,17,0,0,0,0,0,17,17,17,0,0,0,0,0,0,0,0,0,0,17,
                0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,17,17,17,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,17,
                17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17
                
                
                ])
            break
        case "0 1":
            self.loadData([
                
                0,0,0,0,0,0,0,0,17,17,0,17,17,17,0,0,0,0,0,0,0,
                17,0,0,0,0,0,0,0,17,0,0,0,0,17,0,0,0,17,17,17,17,
                17,17,17,17,0,0,0,0,17,0,0,0,0,17,0,0,17,17,0,0,0,
                17,0,0,17,0,0,0,0,17,0,0,0,0,17,17,0,17,0,0,0,0,
                17,0,0,17,0,0,0,0,17,0,0,0,0,0,17,17,17,0,0,0,0,
                17,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,
                17,0,0,17,0,0,0,0,17,17,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,17,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,17,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,17,17,
                17,0,0,17,0,0,0,0,17,17,0,0,0,0,0,0,0,0,0,17,0,
                17,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,17,0,
                17,0,0,0,17,0,0,0,0,17,17,0,0,0,0,0,0,0,0,17,0,
                17,0,0,0,17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,17,0,
                17,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,17,0,
                17,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,17,0,
                17,0,0,0,17,0,0,0,0,0,0,17,0,0,0,0,0,0,0,17,0,
                17,0,0,0,17,0,0,0,0,0,0,17,17,0,0,0,0,0,0,0,17,
                17,0,0,0,17,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,17,
                17,0,0,0,17,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,17,
                17,0,0,0,17,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,
                17,0,0,0,17,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0
                
                
                ])
            break
        case "1 1":
            self.loadData([
                
                0,0,0,0,0,17,17,17,17,17,17,17,0,0,17,17,0,0,0,0,0,
                17,0,0,0,0,17,0,0,17,17,0,17,17,17,17,17,17,0,0,0,17,
                17,0,0,0,0,17,0,0,0,0,17,17,17,17,0,0,17,17,0,17,17,
                17,0,0,0,0,0,17,0,0,0,0,0,17,0,0,0,0,17,0,17,17,
                17,0,0,0,0,0,17,0,0,0,0,0,17,0,0,0,17,17,17,17,17,
                17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,0,17,17,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,17,
                0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,17,
                17,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,17
                
                
                ])
            break
            
        default:
            break
        }
    }
}
